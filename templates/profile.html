<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ user.name }}'s Profile</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css files/profile.css') }}">

</head>
<body>
  <nav class="navbar">
    <div class="logo">AuthentiHire</div>
    <ul class="nav-links">
      <li><a href="{{ url_for('home') }}">Home</a></li>
      <li><a href="{{ url_for('about') }}">About</a></li>
      <li><a href="{{ url_for('contact') }}">Contact</a></li>
      <li><a href="{{ url_for('profile') }}" class="active">Profile</a></li>
      <li><a href="{{ url_for('candidate_logout') }}">Logout</a></li>
      
    </ul>
        <button class="toggle-btn" onclick="toggleMode()" aria-label="Toggle Dark Mode">üåô Dark Mode</button>

  </nav>

  <section class="login-section show">
    <h2>{{ user.name }}'s Profile</h2>
    <p>Here‚Äôs your account information:</p>

    <div class="card" style="max-width:400px; margin:auto; text-align:left;">
      <p><strong>Name:</strong> {{ user.name }}</p>
      <p><strong>Username:</strong> {{ user.username }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Role:</strong> {{ user_type|capitalize }}</p>
    </div>

    <br>
    <div class="login-buttons">
      <a href="{{ url_for('edit_profile') }}">
        <button>Edit Profile</button>
      </a>
      <div class="record-section">
  {% if user_type == 'candidate' %}
  <h3>Video Verification</h3>

  <!-- Live preview while recording -->
  <video id="preview" autoplay muted></video>

  <!-- Playback of uploaded video -->
  <video id="playback" controls style="display:none; margin-top:10px;"></video>

  <div class="record-buttons">
    <button id="startRecord">üé• Start Recording</button>
    <button id="stopRecord" disabled>‚èπ Stop Recording</button>
  </div>
  {% endif %}
</div>

      {% if user_type == 'candidate' %}
      <a href="{{ url_for('candidate_logout') }}">
        <button>Logout</button>
      </a>
      {% else %}
      <a href="{{ url_for('client_logout') }}">
        <button>Logout</button>
      </a>
      {% endif %}
    </div>
  </section>
   <script>
    function toggleMode() {
      document.body.classList.toggle("dark-mode");
      const btn = document.querySelector(".toggle-btn");
      if (document.body.classList.contains("dark-mode")) {
        btn.textContent = "‚òÄ Light Mode";
        localStorage.setItem("theme", "dark");
      } else {
        btn.textContent = "üåô Dark Mode";
        localStorage.setItem("theme", "light");
      }
    }

    window.onload = () => {
      if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
        document.querySelector(".toggle-btn").textContent = "‚òÄ Light Mode";
      }
    };
  </script>
  <script>
  const video = document.getElementById("preview");
  const playback = document.getElementById("playback");
  const startBtn = document.getElementById("startRecord");
  const stopBtn = document.getElementById("stopRecord");
  let mediaRecorder;
  let recordedChunks = [];

  startBtn?.addEventListener("click", async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      video.srcObject = stream;
      playback.style.display = "none";

      mediaRecorder = new MediaRecorder(stream);
      recordedChunks = [];

      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) recordedChunks.push(event.data);
      };

      mediaRecorder.onstop = async () => {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const formData = new FormData();
        formData.append("video", blob);

        // Send to Flask backend
        const response = await fetch("/upload_video", {
          method: "POST",
          body: formData,
        });
        const result = await response.json();

        if (result.path) {
          alert(result.message);
          playback.src = result.path;
          playback.style.display = "block";
        } else {
          alert("Upload failed!");
        }
      };

      mediaRecorder.start();
      startBtn.disabled = true;
      stopBtn.disabled = false;
    } catch (err) {
      console.error("Camera/mic error:", err);
      alert("Please allow camera and microphone access!");
    }
  });

  stopBtn?.addEventListener("click", () => {
    mediaRecorder.stop();
    video.srcObject.getTracks().forEach(track => track.stop());
    startBtn.disabled = false;
    stopBtn.disabled = true;
  });
</script>


</body>
</html>