<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Complete Analytics | AuthentiHire</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css files/style1.css') }}">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: 'Poppins', sans-serif; 
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    color: #fff; 
    padding: 2rem; 
    min-height: 100vh;
}
.header {
    text-align: center;
    margin-bottom: 2rem;
}
.header h1 {
    color:rgb(209, 232, 243);
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
}
.header p {
    color: #94a3b8;
    font-size: 1.1rem;
}
.search-box {
    max-width: 600px;
    margin: 0 auto 3rem;
    display: flex;
    gap: 0.5rem;
}
.search-box input {
    flex: 1;
    padding: 1rem;
    border-radius: 10px;
    border: 2px solid #38bdf8;
    background: rgba(255,255,255,0.1);
    color: #fff;
    font-size: 1.1rem;
}
.search-box input::placeholder { color: #94a3b8; }
.search-box button {
    padding: 1rem 2.5rem;
    border-radius: 10px;
    border: none;
    background: #38bdf8;
    color: #0f172a;
    font-weight: bold;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s;
}
.search-box button:hover { 
    background: #0ea5e9; 
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(56, 189, 248, 0.4);
}

.dashboard {
    max-width: 1800px;
    margin: 0 auto;
    display: none;
}

.section-title {
    color: #38bdf8;
    font-size: 2rem;
    margin: 3rem 0 1.5rem 0;
    text-align: center;
    border-bottom: 2px solid rgba(56, 189, 248, 0.3);
    padding-bottom: 0.5rem;
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}
.stat-card {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(56, 189, 248, 0.3);
    border-radius: 15px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s;
}
.stat-card:hover {
    transform: translateY(-5px);
    border-color: #38bdf8;
    box-shadow: 0 10px 30px rgba(56, 189, 248, 0.2);
}
.stat-card h3 {
    color: #94a3b8;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
}
.stat-card .value {
    font-size: 2.5rem;
    font-weight: bold;
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.stat-card .sub-text {
    color: #64748b;
    font-size: 0.85rem;
    margin-top: 0.3rem;
}

/* Charts */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}
.chart-card {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(56, 189, 248, 0.3);
    border-radius: 15px;
    padding: 2rem;
}
.chart-card h2 {
    color: #38bdf8;
    margin-bottom: 1.5rem;
    font-size: 1.4rem;
}

/* Users Section */
.users-section {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(56, 189, 248, 0.3);
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 3rem;
}
.users-section h2 {
    color: #38bdf8;
    margin-bottom: 1.5rem;
    font-size: 1.6rem;
}
.user-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(56, 189, 248, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s;
}
.user-card:hover {
    border-color: #38bdf8;
    transform: translateX(5px);
}
.user-card h3 {
    color: #38bdf8;
    margin-bottom: 0.75rem;
    font-size: 1.3rem;
}
.user-stats {
    display: flex;
    gap: 2rem;
    margin-bottom: 1rem;
    color: #94a3b8;
    flex-wrap: wrap;
}
.user-stats span {
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 0.75rem;
    margin-top: 1rem;
}
.feature-item {
    background: rgba(255,255,255,0.05);
    padding: 0.75rem;
    border-radius: 8px;
    font-size: 0.95rem;
    border-left: 3px solid #38bdf8;
}

/* Timeline */
.timeline-section {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(56, 189, 248, 0.3);
    border-radius: 15px;
    padding: 2rem;
    max-height: 600px;
    overflow-y: auto;
}
.timeline-section h2 {
    color: #38bdf8;
    margin-bottom: 1.5rem;
    font-size: 1.6rem;
}
.timeline-item {
    background: rgba(255,255,255,0.03);
    border-left: 4px solid #38bdf8;
    padding: 1rem;
    margin-bottom: 0.75rem;
    border-radius: 6px;
    transition: all 0.3s;
}
.timeline-item:hover {
    background: rgba(255,255,255,0.08);
    transform: translateX(5px);
}
.timeline-item .time {
    color: #64748b;
    font-size: 0.85rem;
    margin-bottom: 0.3rem;
}
.timeline-item .content {
    color: #cbd5e1;
}

.loading {
    text-align: center;
    padding: 4rem;
    color: #94a3b8;
    font-size: 1.2rem;
    display: none;
}
.no-data {
    text-align: center;
    padding: 4rem;
    color: #94a3b8;
    font-size: 1.2rem;
}

/* Section divider */
.divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.5), transparent);
    margin: 3rem 0;
}
</style>
</head>
<body>

<div class="header">
    <h1>Complete Meeting Analytics</h1>
    <p>AI Detection, Gaze Tracking & Performance Metrics</p>
    <div class="search-box">
        <input type="text" id="meetingIdInput" placeholder="Enter Meeting ID" />
        <button onclick="loadAllAnalytics()">Load Analytics</button>
    </div>
</div>

<div class="loading" id="loading">Loading analytics...</div>

<div class="dashboard" id="dashboard">
    
    <!-- ========== GAZE ANALYTICS SECTION ========== -->
    <h2 class="section-title"> Gaze Detection Analytics</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Gaze Events</h3>
            <div class="value" id="gazeEvents">0</div>
            <div class="sub-text">Tracked movements</div>
        </div>
        <div class="stat-card">
            <h3>Average Focus</h3>
            <div class="value" id="avgFocus">0%</div>
            <div class="sub-text">Attention score</div>
        </div>
        <div class="stat-card">
            <h3>Users Tracked</h3>
            <div class="value" id="gazeUsers">0</div>
            <div class="sub-text">Participants</div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h2>üß≠ Gaze Direction Distribution</h2>
            <canvas id="gazeDirectionChart"></canvas>
        </div>
        <div class="chart-card">
            <h2>üìä User Focus Scores</h2>
            <canvas id="focusChart"></canvas>
        </div>
    </div>

    <div class="divider"></div>

    <!-- ========== AI DETECTION ANALYTICS SECTION ========== -->
    <h2 class="section-title">ü§ñ AI Detection Analytics</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>üîç Total Checks</h3>
            <div class="value" id="totalChecks">0</div>
            <div class="sub-text">AI detections</div>
        </div>
        <div class="stat-card">
            <h3>‚úÖ Pass</h3>
            <div class="value" id="totalPass" style="color:rgb(23, 73, 2);">0</div>
            <div class="sub-text">Successful checks</div>
        </div>
        <div class="stat-card">
            <h3>‚ö†Ô∏è Warning</h3>
            <div class="value" id="totalWarning" style="color:rgb(180, 120, 16);">0</div>
            <div class="sub-text">Flagged issues</div>
        </div>
        <div class="stat-card">
            <h3>‚ùå Fail</h3>
            <div class="value" id="totalFail" style="color:rgb(101, 8, 8);">0</div>
            <div class="sub-text">Failed checks</div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h2>üìä Detection Results by Feature</h2>
            <canvas id="featuresChart"></canvas>
        </div>
        <div class="chart-card">
            <h2>üéØ Overall Status Distribution</h2>
            <canvas id="statusChart"></canvas>
        </div>
    </div>

    <div class="divider"></div>

    <!-- ========== COMBINED USER ANALYSIS ========== -->
    <div class="users-section">
        <h2>üë• Complete User Analysis (Gaze + AI Detections)</h2>
        <div id="usersList"></div>
    </div>

    <!-- ========== TIMELINE ========== -->
    <div class="timeline-section">
        <h2>üïí All Events Timeline</h2>
        <div id="timeline"></div>
    </div>
</div>

<script>
let charts = {};



async function loadAllAnalytics() {
    const meetingId = document.getElementById("meetingIdInput").value.trim();
    if (!meetingId) {
        alert("‚ö†Ô∏è Please enter a meeting ID");
        return;
    }
    
    document.getElementById("loading").style.display = "block";
    document.getElementById("dashboard").style.display = "none";
    
    try {
        // Fetch ALL data sources at once
        const [gazeRes, aiRes, gazeEventsRes, gazeDirectionRes] = await Promise.all([
            fetch(`/api/gaze_summary/${meetingId}`),
            fetch(`/api/ai_detection_analytics/${meetingId}`),
            fetch(`/api/gaze_events/${meetingId}?limit=1000`),
            fetch(`/api/gaze_direction_distribution/${meetingId}`)
        ]);
        
        const gazeData = await gazeRes.json();
        const aiData = await aiRes.json();
        const gazeEventsData = await gazeEventsRes.json();
        const gazeDirectionData = await gazeDirectionRes.json();
        
        console.log("üìä Gaze Summary:", gazeData);
        console.log("üìä Gaze Events:", gazeEventsData);
        console.log("üìä Gaze Direction:", gazeDirectionData);
        console.log("üìä AI Data:", aiData);
        
        // Check what data we have
        const hasGazeSummary = gazeData.status === "success" && gazeData.summary && gazeData.summary.length > 0;
        const hasGazeEvents = gazeEventsData.status === "success" && gazeEventsData.events && gazeEventsData.events.length > 0;
        const hasAIData = aiData.status === "success";
        
        console.log("‚úÖ Has Gaze Summary:", hasGazeSummary);
        console.log("‚úÖ Has Gaze Events:", hasGazeEvents);
        console.log("‚úÖ Has AI Data:", hasAIData);
        
        if (!hasGazeSummary && !hasGazeEvents && !hasAIData) {
            alert("No data found for this meeting ID: " + meetingId);
            document.getElementById("loading").style.display = "none";
            return;
        }
        
        // ===== GAZE ANALYTICS (with fallback) =====
        renderGazeAnalytics(gazeData, gazeEventsData, gazeDirectionData, meetingId);
        
        // ===== AI DETECTION ANALYTICS =====
        if (hasAIData) {
            renderAIAnalytics(aiData);
        }
        
        // ===== COMBINED USER ANALYSIS =====
        renderCombinedUsers(gazeData, aiData, gazeEventsData);
        
        // ===== COMBINED TIMELINE =====
        renderCombinedTimeline(gazeData, aiData, gazeEventsData, meetingId);
        
        document.getElementById("loading").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        
    } catch (err) {
        console.error("‚ùå Error loading analytics:", err);
        alert("‚ùå Error loading analytics. Check console for details.");
        document.getElementById("loading").style.display = "none";
    }
}

function renderGazeAnalytics(gazeData, gazeEventsData, gazeDirectionData, meetingId) {
    let totalEvents = 0;
    let totalFocus = 0;
    let userCount = 0;
    
    // Try summary first
    const hasSummary = gazeData.status === "success" && gazeData.summary && gazeData.summary.length > 0;
    const hasEvents = gazeEventsData.status === "success" && gazeEventsData.events && gazeEventsData.events.length > 0;
    
    if (hasSummary) {
        console.log("‚úÖ Using gaze_summary data");
        gazeData.summary.forEach(u => {
            totalEvents += u.total_events || 0;
            totalFocus += u.focus_percentage || 0;
        });
        userCount = gazeData.summary.length;
    } else if (hasEvents) {
        console.log("‚úÖ Calculating from raw gaze_data events");
        // Calculate from raw events
        totalEvents = gazeEventsData.events.length;
        
        // Get unique users
        const userEvents = {};
        gazeEventsData.events.forEach(e => {
            if (!userEvents[e.user_id]) {
                userEvents[e.user_id] = { total: 0, focused: 0 };
            }
            userEvents[e.user_id].total++;
            // Count "Center" or non-"away" as focused
            if (e.direction.toLowerCase() === 'center' || e.direction.toLowerCase() !== 'away') {
                userEvents[e.user_id].focused++;
            }
        });
        
        userCount = Object.keys(userEvents).length;
        
        // Calculate average focus
        Object.values(userEvents).forEach(stats => {
            const userFocus = (stats.focused / stats.total) * 100;
            totalFocus += userFocus;
        });
    } else {
        console.log("‚ö†Ô∏è No gaze data available");
    }
    
    const avgFocus = userCount > 0 ? (totalFocus / userCount).toFixed(1) : 0;
    
    console.log(`üìä Stats: Events=${totalEvents}, Focus=${avgFocus}%, Users=${userCount}`);
    
    // Update UI
    document.getElementById("gazeEvents").textContent = totalEvents;
    document.getElementById("avgFocus").textContent = avgFocus + "%";
    document.getElementById("gazeUsers").textContent = userCount;
    
    // Render direction chart
    if (gazeDirectionData.status === "success" && gazeDirectionData.percentages) {
        console.log("‚úÖ Using direction distribution from API");
        renderGazeDirectionChart(gazeDirectionData.percentages);
    } else if (hasEvents) {
        console.log("‚úÖ Calculating direction distribution from events");
        // Calculate from events
        const directionCounts = {};
        gazeEventsData.events.forEach(e => {
            const dir = e.direction;
            directionCounts[dir] = (directionCounts[dir] || 0) + 1;
        });
        
        const total = gazeEventsData.events.length;
        const percentages = {};
        Object.keys(directionCounts).forEach(dir => {
            percentages[dir] = parseFloat(((directionCounts[dir] / total) * 100).toFixed(2));
        });
        
        renderGazeDirectionChart(percentages);
    } else {
        console.log("‚ö†Ô∏è Using dummy direction data");
        renderGazeDirectionChart({ "No Data": 100 });
    }
    
    // Render focus chart
    if (hasSummary) {
        renderFocusChart(gazeData.summary);
    } else if (hasEvents) {
        // Calculate per-user focus from events
        const userEvents = {};
        gazeEventsData.events.forEach(e => {
            if (!userEvents[e.user_id]) {
                userEvents[e.user_id] = { total: 0, focused: 0 };
            }
            userEvents[e.user_id].total++;
            if (e.direction.toLowerCase() === 'center' || e.direction.toLowerCase() !== 'away') {
                userEvents[e.user_id].focused++;
            }
        });
        
        const summary = Object.keys(userEvents).map(userId => ({
            user_id: userId,
            focus_percentage: ((userEvents[userId].focused / userEvents[userId].total) * 100).toFixed(2),
            total_events: userEvents[userId].total
        }));
        
        renderFocusChart(summary);
    } else {
        renderFocusChart([]);
    }
}

function renderGazeDirectionChart(percentages) {
    const ctx = document.getElementById("gazeDirectionChart").getContext("2d");
    if (charts.gazeDirection) charts.gazeDirection.destroy();
    
    const labels = Object.keys(percentages);
    const data = Object.values(percentages);
    
    charts.gazeDirection = new Chart(ctx, {
        type: "doughnut",
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: ["#22d3ee", "#a855f7", "#f97316", "#84cc16", "#3b82f6", "#ec4899"],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            plugins: { 
                legend: { 
                    labels: { color: "#fff" }, 
                    position: "bottom" 
                },
                tooltip: {
                    callbacks: {
                        label: ctx => ctx.label + ": " + ctx.parsed.toFixed(2) + "%"
                    }
                }
            }
        }
    });
}

function renderFocusChart(summary) {
    const ctx = document.getElementById("focusChart").getContext("2d");
    if (charts.focus) charts.focus.destroy();
    
    if (!summary || summary.length === 0) {
        ctx.font = "16px Poppins";
        ctx.fillStyle = "#94a3b8";
        ctx.textAlign = "center";
        ctx.fillText("No user focus data available", ctx.canvas.width / 2, ctx.canvas.height / 2);
        return;
    }
    
    const users = summary.map(u => u.user_id);
    const focusData = summary.map(u => parseFloat(u.focus_percentage));
    
    const colors = focusData.map(f => 
        f >= 80 ? "#10b981" : f >= 50 ? "#f59e0b" : "#ef4444"
    );
    
    charts.focus = new Chart(ctx, {
        type: "bar",
        data: {
            labels: users,
            datasets: [{
                label: "Focus %",
                data: focusData,
                backgroundColor: colors,
                borderRadius: 5
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                x: { ticks: { color: "#94a3b8" }, grid: { color: "rgba(148,163,184,0.1)" } },
                y: { 
                    ticks: { color: "#94a3b8" }, 
                    grid: { color: "rgba(148,163,184,0.1)" },
                    max: 100,
                    beginAtZero: true
                }
            }
        }
    });
}

function renderAIAnalytics(aiData) {
    document.getElementById("totalChecks").textContent = aiData.total_checks || 0;
    document.getElementById("totalPass").textContent = aiData.total_pass || 0;
    document.getElementById("totalWarning").textContent = aiData.total_warning || 0;
    document.getElementById("totalFail").textContent = aiData.total_fail || 0;
    
    renderFeaturesChart(aiData.features_summary);
    renderStatusChart(aiData.total_pass, aiData.total_warning, aiData.total_fail);
}

function renderFeaturesChart(features) {
    const ctx = document.getElementById("featuresChart").getContext("2d");
    if (charts.features) charts.features.destroy();
    
    const featureNames = {
        'deepfake': 'Deepfake', 'liveness': 'Liveness',
        'multiperson': 'Multi-Person', 'face_match': 'Face Match',
        'bias': 'Bias', 'audio_clarity': 'Audio', 'hand_raise': 'Hand Raise'
    };
    
    const labels = Object.keys(features).map(f => featureNames[f] || f);
    const passData = Object.values(features).map(f => f.pass);
    const warnData = Object.values(features).map(f => f.warning);
    const failData = Object.values(features).map(f => f.fail);
    
    charts.features = new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [
                { label: "‚úÖ Pass", data: passData, backgroundColor: "#10b981", borderRadius: 5 },
                { label: "‚ö†Ô∏è Warning", data: warnData, backgroundColor: "#f59e0b", borderRadius: 5 },
                { label: "‚ùå Fail", data: failData, backgroundColor: "#ef4444", borderRadius: 5 }
            ]
        },
        options: {
            responsive: true,
            plugins: { legend: { labels: { color: "#fff" }, position: "top" } },
            scales: {
                x: { ticks: { color: "#94a3b8" }, grid: { color: "rgba(148,163,184,0.1)" } },
                y: { ticks: { color: "#94a3b8" }, grid: { color: "rgba(148,163,184,0.1)" } }
            }
        }
    });
}

function renderStatusChart(totalPass, totalWarning, totalFail) {
    const ctx = document.getElementById("statusChart").getContext("2d");
    if (charts.status) charts.status.destroy();
    
    charts.status = new Chart(ctx, {
        type: "doughnut",
        data: {
            labels: ["‚úÖ Pass", "‚ö†Ô∏è Warning", "‚ùå Fail"],
            datasets: [{
                data: [totalPass, totalWarning, totalFail],
                backgroundColor: ["#10b981", "#f59e0b", "#ef4444"],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { labels: { color: "#fff" }, position: "bottom" } }
        }
    });
}

function renderCombinedUsers(gazeData, aiData, gazeEventsData) {
    const container = document.getElementById("usersList");
    container.innerHTML = "";
    
    const allUsers = new Set();
    
    // Collect all users
    if (gazeData.status === "success" && gazeData.summary) {
        gazeData.summary.forEach(u => allUsers.add(u.user_id));
    }
    if (gazeEventsData.status === "success" && gazeEventsData.events) {
        gazeEventsData.events.forEach(e => allUsers.add(e.user_id));
    }
    if (aiData.status === "success" && aiData.user_summary) {
        Object.keys(aiData.user_summary).forEach(u => allUsers.add(u));
    }
    
    if (allUsers.size === 0) {
        container.innerHTML = '<p class="no-data">No user data available</p>';
        return;
    }
    
    allUsers.forEach(userId => {
        const gazeInfo = gazeData.summary ? gazeData.summary.find(u => u.user_id === userId) : null;
        const aiInfo = aiData.user_summary ? aiData.user_summary[userId] : null;
        
        const card = document.createElement("div");
        card.className = "user-card";
        
        let html = `<h3>üë§ ${userId}</h3><div class="user-stats">`;
        
        if (gazeInfo) {
            html += `
                <span>üëÅÔ∏è <strong>${gazeInfo.focus_percentage}%</strong> focus</span>
                <span>üìä <strong>${gazeInfo.total_events}</strong> gaze events</span>
            `;
        }
        
        if (aiInfo) {
            html += `
                <span>üîç <strong>${aiInfo.total_checks}</strong> AI checks</span>
                <span style="color: #10b981;">‚úÖ <strong>${aiInfo.pass_count}</strong></span>
                <span style="color: #f59e0b;">‚ö†Ô∏è <strong>${aiInfo.warning_count}</strong></span>
                <span style="color: #ef4444;">‚ùå <strong>${aiInfo.fail_count}</strong></span>
            `;
        }
        
        html += `</div>`;
        
        if (aiInfo && aiInfo.features) {
            html += `<div class="feature-grid">`;
            Object.entries(aiInfo.features).forEach(([feat, status]) => {
                const names = {
                    'deepfake': 'Deepfake', 'liveness': 'Liveness',
                    'multiperson': 'Multi-Person', 'face_match': 'Face Match',
                    'bias': 'Bias', 'audio_clarity': 'Audio', 'hand_raise': 'Hand Raise'
                };
                html += `<div class="feature-item"><strong>${names[feat] || feat}:</strong><br>${status}</div>`;
            });
            html += `</div>`;
        }
        
        card.innerHTML = html;
        container.appendChild(card);
    });
}

function renderCombinedTimeline(gazeData, aiData, gazeEventsData, meetingId) {
    const container = document.getElementById("timeline");
    container.innerHTML = "";
    
    const timeline = [];
    
    // Add AI events
    if (aiData.status === "success" && aiData.timeline) {
        aiData.timeline.forEach(event => {
            timeline.push({
                time: new Date(event.time),
                type: "ai",
                user: event.user,
                feature: event.feature,
                status: event.status
            });
        });
    }
    
    // Add gaze events
    if (gazeEventsData.status === "success" && gazeEventsData.events) {
        gazeEventsData.events.forEach(event => {
            timeline.push({
                time: new Date(event.timestamp),
                type: "gaze",
                user: event.user_id,
                direction: event.direction
            });
        });
    }
    
    if (timeline.length === 0) {
        container.innerHTML = '<p class="no-data">No timeline events available</p>';
        return;
    }
    
    timeline.sort((a, b) => b.time - a.time);
    
    timeline.slice(0, 100).forEach(event => {
        const item = document.createElement("div");
        item.className = "timeline-item";
        
        if (event.type === "ai") {
            const names = {
                'deepfake': 'Deepfake', 'liveness': 'Liveness',
                'multiperson': 'Multi-Person', 'face_match': 'Face Match',
                'bias': 'Bias', 'audio_clarity': 'Audio', 'hand_raise': 'Hand Raise'
            };
            item.innerHTML = `
                <div class="time">${event.time.toLocaleString()}</div>
                <div class="content">
                    <strong style="color: #38bdf8;">${event.user}</strong> ‚Ä∫ 
                    ${names[event.feature] || event.feature}: ${event.status}
                </div>
            `;
        } else if (event.type === "gaze") {
            item.innerHTML = `
                <div class="time">${event.time.toLocaleString()}</div>
                <div class="content">
                    <strong style="color: #38bdf8;">${event.user}</strong> ‚Ä∫ 
                    üëÅÔ∏è Gaze: ${event.direction}
                </div>
            `;
        }
        
        container.appendChild(item);
    });
}
</script>

</body>
</html>